{% extends 'hrms_app/base.html' %}
{% block title %} Home {% endblock title %}
{% block content %}

<!-- Contenitore generale homepage -->
<div class="container-fluid d-flex flex-wrap">

    <!-- Visualizza la bacheca -->
    <div class="container-fluid" style="background-color: white; padding: 20px; opacity: 90%; border-radius: 10px; max-height: 160px; overflow: auto; margin-bottom: 20px">
        {% for messaggio_bacheca in messaggi_bacheca %}
            <h5>{{ messaggio_bacheca.titolo }}</h5>
            <p>{{ messaggio_bacheca.messaggio }}</p>
        {% endfor %}
    </div>
    
    <!-- Form per la timbratura delle presenze -->
    <div class="container" style="background-color: white; padding: 15px 50px; opacity: 90%; border-radius: 10px; width: auto; height: 300px">

        <!-- Orologio -->
        <div style="margin-bottom: 10px">
            <span id="data" style="font-size: regular"></span><br>
            <span id="ora" style="font-weight: bold; font-size: x-large"></span>        
        </div>
        
        <!-- Pulsante di timbratura -->

        <form action="{% url 'gestione_timbratura' %}" method="POST">
            {% csrf_token %}       
            <button type="submit" class="btn btn-primary btn-large" style="margin-bottom: 15px; font-weight: bold">   
                {{ text_button }}
            </button>
        </form>

        <!--Tabella delle timbrature del giorno-->
        <table class="table table-sm caption-top" style="width: 100px; margin-bottom: 0px">
            <caption style="font-size: small; padding: 0px; text-align: center">Lista timbrature</caption>
            <thead>
                <tr style="font-size: small">
                    <th scope="col">Entrata</th>
                    <th scope="col">Uscita</th>           
                </tr>
            </thead>
        </table>
        <div style="max-height: 83px; overflow-Y: auto">
            <table class="table table-sm" style="width: 100px">
                <tbody>
                    {% for presenza in lista_presenze %}
                        <tr style="font-size: small">
                            <td> {{ presenza.ora_ingresso|date:"H:i" }} </td>
                            <td> {{ presenza.ora_uscita|date:"H:i" }} </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Messaggio di errore -->
        {% if messaggio_errore %}
            <p style="font-size: small"> {{ messaggio_errore }} </p>
        {% endif %}
    </div>    
    
    <!-- Form per la richiesta dei permessi o ferie -->
    <div class="container" style="background-color: white; padding: 15px 50px; opacity: 90%; border-radius: 10px; width: auto; height: 300px; overflow: auto">
        <form action="{% url 'richiesta_permessi_ferie' %}" method="POST">
            {% csrf_token %} 
            <h3>Richiesta Assenze</h3>
            
            <div class="form-check">
                <input class="form-check-input" type="radio" id="flexRadioDefault1" name="tipo_permesso" value="ferie" checked>
                <label class="form-check-label" for="flexRadioDefault1">Ferie</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" id="flexRadioDefault2" name="tipo_permesso" value="permesso">
                <label class="form-check-label" for="flexRadioDefault2">Permesso</label>
            </div>
            <div class="form-check">            
                <input class="form-check-input" type="radio" id="flexRadioDefault3" name="tipo_permesso" value="Permesso_nr">
                <label class="form-check-label" for="flexRadioDefault3">Permesso non retribuito</label>
            </div>                     

            <div class="mb-3">
                <label for="data_inizio" class="form-label">Data inizio</label>
                <input type="date" class="form-control" id="data_inizio" min={% now "Y-m-d" %} required>
                <input type="time" class="form-control" id="ora_inizio" min="09:00" max="18:00" required>
            </div>            
            <div class="mb-3">
                <label for="data_fine" class="form-label">Data fine</label>
                <input type="date" class="form-control" id="data_fine" placeholder="Data di fine ferie" min={% now "Y-m-d" %} required>
                <input type="time" class="form-control" id="ora_fine" min="09:00" max="18:00" required>
            </div>
            <input class="form-control" type="text" placeholder="Motivo della richiesta" aria-label="default input example">
            <button type="submit" class="btn btn-primary">Invia Richiesta</button>
        </form>
        <p>{{ tipo_permesso }} {{ data_inizio }} {{ ora_inizio }} {{ data_fine }} {{ ora_fine }} {{ motivo }} {{ dipendente }}</p>
    </div>

    -->

    <!--TODO Creare l'elenco tramite ciclo For -->
    <!--TODO Definire se aggiungere una lista delle persone che hanno le ferie confermate -->

    <!--

    <div class="container">
        <h3>Elenco ferie richieste:</h3>
        <ul class="list-group">
            {% for dipendente in richiesta_ferie%}
            <li class="list-group-item">
            <input class="form-check-input me-1" type="checkbox" value="" id="firstCheckboxStretched">
            <label class="form-check-label stretched-link" for="firstCheckboxStretched">{{ dipendente.nome }}{{dipendente.cognome }}{{ dipendente.data_inizio}}{{ dipendente.data_fine}}</label>
            </li>
            {% endfor %}
        </ul>

        <button href="{% url 'accetta_ferie' %}" type="button" class="btn btn-primary">Accetta</button>
        <button href="{% url 'rifiuta_ferie' %}" type="button" class="btn btn-primary">Rifiuta</button>
    </div>

    <div class="container">    
        <button href="{% url 'visualizza_busta_paga' %}" type="button" class="btn btn-primary">Scarica busta paga</button>
    </div> -->

</div>

<script>

    // Funzione per generare l'orologio delle timbrature

    function aggiornaOrologio() {
        let now = new Date();
        let giorno = now.getDate();
        let mese = now.toLocaleString("it-IT", { month: "long" });  // Nome del mese
        let anno = now.getFullYear();
        let ore = now.getHours().toString().padStart(2, '0');
        let minuti = now.getMinutes().toString().padStart(2, '0');
        let secondi = now.getSeconds().toString().padStart(2, '0');
        let data = `${giorno} ${mese} ${anno}`;
        let ora = `${ore}:${minuti}:${secondi}`;
        document.getElementById("ora").textContent = `${ora}`;
        document.getElementById("data").textContent = `${data}`;
    }

    setInterval(aggiornaOrologio, 1000); // Aggiorna ogni secondo
    aggiornaOrologio(); // Imposta subito l'ora senza aspettare   

</script>

{% endblock %}

